/*! iplayer - v0.1.0 - 2016-02-15
* https://github.com/senntyou/iplayer
* Copyright (c) 2016 senntyou; Licensed MIT */
(function(e,o){"use strict";function t(o,t){var n=this,t=t||{};n.options=e.extend(!0,{},i,t),n.state={fullscreen:!1,listShowing:!1},n.state.playbackRate=1,n.state.displayTransitions=!0,n.originTimelineData=e.extend([],o),n.diaporamaData={},n.diaporamaData.generator={version:"0.2.2",url:"https://github.com/gre/diaporama-maker"},n.diaporamaData.transitions=r,n.fullscreen=n._fullscreen(),n.storage=n._storage(),n.browser=n._browserSniff(),n.itemsCount=n.originTimelineData.length,n.currentIndex=0,n._hideTimer=null,n._init()}var i={diaporama:{loop:!0,autoplay:!0,playbackRate:1,networkTimeout:5e3},listCellTpl:'<div class="iplayer-list-cell"><img width="40px" height="40px"></div>',autoplay:!0,shareCode:"",minPlaybackRate:.2,maxPlaybackRate:5,showLogo:!1,maxTransitionTime:1800,minTransitionTime:1200,maxSlideTime:6e3,minSlideTime:4e3,maxEasing:.8,minEasing:.2,minKenburnsRatio:.4},r=[{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from,to;uniform float progress;uniform vec2 resolution;uniform float persp;uniform float unzoom;uniform float reflection;uniform float floating;vec2 project(vec2 p){return p*vec2(1.0,-1.2)+vec2(0.0,-floating/100.);}bool inBounds(vec2 p){return all(lessThan(vec2(0.0),p))&&all(lessThan(p,vec2(1.0)));}vec4 bgColor(vec2 p,vec2 pfr,vec2 pto){vec4 c=vec4(0.0,0.0,0.0,1.0);pfr=project(pfr);if(inBounds(pfr)){c+=mix(vec4(0.0),texture2D(from,pfr),reflection*mix(1.0,0.0,pfr.y));}pto=project(pto);if(inBounds(pto)){c+=mix(vec4(0.0),texture2D(to,pto),reflection*mix(1.0,0.0,pto.y));}return c;}vec2 xskew(vec2 p,float persp,float center){float x=mix(p.x,1.0-p.x,center);return ((vec2(x,(p.y-0.5*(1.0-persp)*x)/(1.0+(persp-1.0)*x))-vec2(0.5-distance(center,0.5),0.0))*vec2(0.5/distance(center,0.5)*(center<0.5?1.0:-1.0),1.0)+vec2(center<0.5?0.0:1.0,0.0));}void main(){vec2 op=gl_FragCoord.xy/resolution.xy;float uz=unzoom*2.0*(0.5-distance(0.5,progress));vec2 p=-uz*0.5+(1.0+uz)*op;vec2 fromP=xskew((p-vec2(progress,0.0))/vec2(1.0-progress,1.0),1.0-mix(progress,0.0,persp),0.0);vec2 toP=xskew(p/vec2(progress,1.0),mix(pow(progress,2.0),1.0,persp),1.0);if(inBounds(fromP)){gl_FragColor=texture2D(from,fromP);}else if(inBounds(toP)){gl_FragColor=texture2D(to,toP);}else{gl_FragColor=bgColor(op,fromP,toP);}}",uniforms:{persp:.7,unzoom:.3,reflection:.4,floating:3},name:"cube"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from,to;uniform float progress;uniform vec2 resolution;uniform float strength;const float PI=3.141592653589793;float Linear_ease(in float begin,in float change,in float duration,in float time){return change*time/duration+begin;}float Exponential_easeInOut(in float begin,in float change,in float duration,in float time){if(time==0.0) return begin;else if(time==duration) return begin+change;time=time/(duration/2.0);if(time<1.0) return change/2.0*pow(2.0,10.0*(time-1.0))+begin;return change/2.0*(-pow(2.0,-10.0*(time-1.0))+2.0)+begin;}float Sinusoidal_easeInOut(in float begin,in float change,in float duration,in float time){return -change/2.0*(cos(PI*time/duration)-1.0)+begin;}float random(in vec3 scale,in float seed){return fract(sin(dot(gl_FragCoord.xyz+seed,scale))*43758.5453+seed);}vec3 crossFade(in vec2 uv,in float dissolve){return mix(texture2D(from,uv).rgb,texture2D(to,uv).rgb,dissolve);}void main(){vec2 texCoord=gl_FragCoord.xy/resolution.xy;vec2 center=vec2(Linear_ease(0.25,0.5,1.0,progress),0.5);float dissolve=Exponential_easeInOut(0.0,1.0,1.0,progress);float strength=Sinusoidal_easeInOut(0.0,strength,0.5,progress);vec3 color=vec3(0.0);float total=0.0;vec2 toCenter=center-texCoord;float offset=random(vec3(12.9898,78.233,151.7182),0.0);for(float t=0.0;t<=40.0;t++){float percent=(t+offset)/40.0;float weight=4.0*(percent-percent*percent);color+=crossFade(texCoord+toCenter*percent*strength,dissolve)*weight;total+=weight;}gl_FragColor=vec4(color/total,1.0);}",uniforms:{strength:.4},name:"CrossZoom"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from,to;uniform float progress;uniform vec2 resolution;void main(void){vec2 p=gl_FragCoord.xy/resolution.xy;float T=progress;float S0=1.0;float S1=50.0;float S2=1.0;float Half=0.5;float PixelSize=(T<Half)?mix(S0,S1,T/Half):mix(S1,S2,(T-Half)/Half);vec2 D=PixelSize/resolution.xy;vec2 UV=(p+vec2(-0.5))/D;vec2 Coord=clamp(D*(ceil(UV+vec2(-0.5)))+vec2(0.5),vec2(0.0),vec2(1.0));vec4 C0=texture2D(from,Coord);vec4 C1=texture2D(to,Coord);gl_FragColor=mix(C0,C1,T);}",uniforms:{},name:"AdvancedMosaic"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;\nuniform float progress;\nuniform vec2 resolution;\nuniform vec3 color;void main() {vec2 p = gl_FragCoord.xy / resolution.xy;gl_FragColor = mix(texture2D(from, p) + vec4(progress*color, 1.0),texture2D(to, p) + vec4((1.0-progress)*color, 1.0),progress);}",uniforms:{color:[.9,.4,.2]},name:"burn"},{glsl:"\n#ifdef GL_ES \nprecision highp float;\n#endif\nuniform sampler2D from;\nuniform sampler2D to;\nuniform float progress;\nuniform vec2 resolution;\nuniform float smoothness;\nuniform bool opening;\nconst vec2 center = vec2(0.5, 0.5);\nconst float SQRT_2 = 1.414213562373;void main() {vec2 p = gl_FragCoord.xy / resolution.xy;float x = opening ? progress : 1.-progress;float m = smoothstep(-smoothness, 0.0, SQRT_2*distance(center, p) - x*(1.+smoothness));gl_FragColor = mix(texture2D(from, p), texture2D(to, p), opening ? 1.-m : m);}",uniforms:{smoothness:.3,opening:!0},name:"circleopen"},{glsl:"\n#ifdef GL_ES \nprecision highp float;\n#endif\nuniform sampler2D from;\nuniform sampler2D to;\nuniform float progress;\nuniform vec2 resolution;\nuniform float smoothness;\nuniform bool opening;\nconst vec2 center = vec2(0.5, 0.5);\nconst float SQRT_2 = 1.414213562373;void main() {vec2 p = gl_FragCoord.xy / resolution.xy;float x = opening ? progress : 1.-progress;float m = smoothstep(-smoothness, 0.0, SQRT_2*distance(center, p) - x*(1.+smoothness));gl_FragColor = mix(texture2D(from, p), texture2D(to, p), opening ? 1.-m : m);}",uniforms:{smoothness:.3,opening:!1},name:"circleclose"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;\nuniform float progress;\nuniform vec2 resolution;\nuniform float interpolationPower;void main() {vec2 p = gl_FragCoord.xy / resolution.xy;vec4 fTex = texture2D(from,p);vec4 tTex = texture2D(to,p);gl_FragColor = mix(distance(fTex,tTex)>progress?fTex:tTex,tTex,pow(progress,interpolationPower));}",uniforms:{interpolationPower:5},name:"colourDistance"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;\nuniform sampler2D to;\nuniform float progress;\nuniform vec2 resolution;\nconst vec2 center = vec2(0.5, 0.5);float quadraticInOut(float t) {float p = 2.0 * t * t;return t < 0.5 ? p : -p + (4.0 * t) - 1.0;}float rand(vec2 co) {return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);}void main() {vec2 p = gl_FragCoord.xy / resolution.xy;if (progress == 0.0) {gl_FragColor = texture2D(from, p);} else if (progress == 1.0) {gl_FragColor = texture2D(to, p);} else {float x = progress;float dist = distance(center, p);float r = x - min(rand(vec2(p.y, 0.0)), rand(vec2(0.0, p.x)));float m = dist <= r ? 1.0 : 0.0;gl_FragColor = mix(texture2D(from, p), texture2D(to, p), m);}}",uniforms:{},name:"crosshatch"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform float progress;uniform vec2 resolution;uniform sampler2D from;uniform sampler2D to;void main(void){vec2 p = gl_FragCoord.xy / resolution.xy;float T = progress;float S0 = 1.0;float S1 = 50.0;float S2 = 1.0;float Half = 0.5;float PixelSize = ( T < Half ) ? mix( S0, S1, T / Half ) : mix( S1, S2, (T-Half) / Half );vec2 D = PixelSize / resolution.xy;vec2 UV = (gl_FragCoord.xy / resolution.xy);const int NumTaps = 12;vec2 Disk[NumTaps];Disk[0] = vec2(-.326,-.406);Disk[1] = vec2(-.840,-.074);Disk[2] = vec2(-.696, .457);Disk[3] = vec2(-.203, .621);Disk[4] = vec2( .962,-.195);Disk[5] = vec2( .473,-.480);Disk[6] = vec2( .519, .767);Disk[7] = vec2( .185,-.893);Disk[8] = vec2( .507, .064);Disk[9] = vec2( .896, .412);Disk[10] = vec2(-.322,-.933);Disk[11] = vec2(-.792,-.598);vec4 C0 = texture2D( from, UV );vec4 C1 = texture2D( to, UV );for ( int i = 0; i != NumTaps; i++ ){C0 += texture2D( from, Disk[i] * D + UV );C1 += texture2D( to, Disk[i] * D + UV );}C0 /= float(NumTaps+1);C1 /= float(NumTaps+1);gl_FragColor = mix( C0, C1, T );}",uniforms:{},name:"DefocusBlur"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform vec2 direction;uniform float smoothness;const vec2 center=vec2(0.5,0.5);void main(){vec2 p=gl_FragCoord.xy/resolution.xy;vec2 v=normalize(direction);v/=abs(v.x)+abs(v.y);float d=v.x*center.x+v.y*center.y;float m=smoothstep(-smoothness,0.0,v.x*p.x+v.y*p.y-(d-0.5+progress*(1.+smoothness)));gl_FragColor=mix(texture2D(to,p),texture2D(from,p),m);}",uniforms:{direction:[1,-1],smoothness:.5},name:"directionalwipe"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform vec2 direction;uniform float smoothness;const vec2 center=vec2(0.5,0.5);void main(){vec2 p=gl_FragCoord.xy/resolution.xy;vec2 v=normalize(direction);v/=abs(v.x)+abs(v.y);float d=v.x*center.x+v.y*center.y;float m=smoothstep(-smoothness,0.0,v.x*p.x+v.y*p.y-(d-0.5+progress*(1.+smoothness)));gl_FragColor=mix(texture2D(to,p),texture2D(from,p),m);}",uniforms:{direction:[1,0],smoothness:.5},name:"directionalwipe 1x0"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform vec2 direction;uniform float smoothness;const vec2 center=vec2(0.5,0.5);void main(){vec2 p=gl_FragCoord.xy/resolution.xy;vec2 v=normalize(direction);v/=abs(v.x)+abs(v.y);float d=v.x*center.x+v.y*center.y;float m=smoothstep(-smoothness,0.0,v.x*p.x+v.y*p.y-(d-0.5+progress*(1.+smoothness)));gl_FragColor=mix(texture2D(to,p),texture2D(from,p),m);}",uniforms:{direction:[1,1],smoothness:.5},name:"directionalwipe 1x1"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform vec2 direction;uniform float smoothness;const vec2 center=vec2(0.5,0.5);void main(){vec2 p=gl_FragCoord.xy/resolution.xy;vec2 v=normalize(direction);v/=abs(v.x)+abs(v.y);float d=v.x*center.x+v.y*center.y;float m=smoothstep(-smoothness,0.0,v.x*p.x+v.y*p.y-(d-0.5+progress*(1.+smoothness)));gl_FragColor=mix(texture2D(to,p),texture2D(from,p),m);}",uniforms:{direction:[-1,-1],smoothness:.5},name:"directionalwipe -1x-1"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform vec2 direction;uniform float smoothness;const vec2 center=vec2(0.5,0.5);void main(){vec2 p=gl_FragCoord.xy/resolution.xy;vec2 v=normalize(direction);v/=abs(v.x)+abs(v.y);float d=v.x*center.x+v.y*center.y;float m=smoothstep(-smoothness,0.0,v.x*p.x+v.y*p.y-(d-0.5+progress*(1.+smoothness)));gl_FragColor=mix(texture2D(to,p),texture2D(from,p),m);}",uniforms:{direction:[-1,0],smoothness:.5},name:"directionalwipe -1x0"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform vec2 direction;uniform float smoothness;const vec2 center=vec2(0.5,0.5);void main(){vec2 p=gl_FragCoord.xy/resolution.xy;vec2 v=normalize(direction);v/=abs(v.x)+abs(v.y);float d=v.x*center.x+v.y*center.y;float m=smoothstep(-smoothness,0.0,v.x*p.x+v.y*p.y-(d-0.5+progress*(1.+smoothness)));gl_FragColor=mix(texture2D(to,p),texture2D(from,p),m);}",uniforms:{direction:[-1,1],smoothness:.5},name:"directionalwipe -1x1"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define QUALITY 32\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform float size;const float GOLDEN_ANGLE = 2.399963229728653;vec4 blur(sampler2D t, vec2 c, float radius) {vec4 sum = vec4(0.0);float q = float(QUALITY);for (int i=0; i<QUALITY; ++i) {float fi = float(i);float a = fi * GOLDEN_ANGLE;float r = sqrt(fi / q) * radius;vec2 p = c + r * vec2(cos(a), sin(a));sum += texture2D(t, p);}return sum / q;}void main(){vec2 p = gl_FragCoord.xy / resolution.xy;float inv = 1.-progress;gl_FragColor = inv*blur(from, p, progress*size) + progress*blur(to, p, inv*size);}",uniforms:{size:.6},name:"dispersionblur"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;uniform float progress;uniform vec2 resolution;uniform int barWidth;uniform float amplitude;uniform float noise;uniform float frequency;float rand(int num) {return fract(mod(float(num) * 67123.313, 12.0) * sin(float(num) * 10.3) * cos(float(num)));}float wave(int num) {float fn = float(num) * frequency * 0.1  * float(barWidth);return cos(fn * 0.5) * cos(fn * 0.13) * sin((fn+10.0) * 0.3) / 2.0 + 0.5;}float pos(int num) {return noise == 0.0 ? wave(num) : mix(wave(num), rand(num), noise);}void main() {int bar = int(gl_FragCoord.x) / barWidth;float scale = 1.0 + pos(bar) * amplitude;float phase = progress * scale;float posY = gl_FragCoord.y / resolution.y;vec2 p;vec4 c;if (phase + posY < 1.0) {p = vec2(gl_FragCoord.x, gl_FragCoord.y + mix(0.0, resolution.y, phase)) / resolution.xy;c = texture2D(from, p);} else {p = gl_FragCoord.xy / resolution.xy;c = texture2D(to, p);}gl_FragColor = c;}",uniforms:{barWidth:10,amplitude:2,noise:.2,frequency:1},name:"DoomScreenTransition"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform float reflection;uniform float perspective;uniform float depth;const vec4 black=vec4(0.0,0.0,0.0,1.0);const vec2 boundMin=vec2(0.0,0.0);const vec2 boundMax=vec2(1.0,1.0);bool inBounds(vec2 p){return all(lessThan(boundMin,p))&&all(lessThan(p,boundMax));}vec2 project(vec2 p){return p*vec2(1.0,-1.2)+vec2(0.0,-0.02);}vec4 bgColor(vec2 p,vec2 pto){vec4 c=black;pto=project(pto);if(inBounds(pto)){c+=mix(black,texture2D(to,pto),reflection*mix(1.0,0.0,pto.y));}return c;}void main(){vec2 p=gl_FragCoord.xy/resolution.xy;vec2 pfr=vec2(-1.),pto=vec2(-1.);float middleSlit=2.0*abs(p.x-0.5)-progress;if(middleSlit>0.0){pfr=p+(p.x>0.5?-1.0:1.0)*vec2(0.5*progress,0.0);float d=1.0/(1.0+perspective*progress*(1.0-middleSlit));pfr.y-=d/2.;pfr.y*=d;pfr.y+=d/2.;}float size=mix(1.0,depth,1.-progress);pto=(p+vec2(-0.5,-0.5))*vec2(size,size)+vec2(0.5,0.5);if(inBounds(pfr)){gl_FragColor=texture2D(from,pfr);}else if(inBounds(pto)){gl_FragColor=texture2D(to,pto);}else{gl_FragColor=bgColor(p,pto);}}",uniforms:{reflection:.4,perspective:.4,depth:3},name:"doorway"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;uniform float progress;uniform vec2 resolution;vec2 offset(float progress, float x, float theta) {float phase = progress*progress + progress + theta;float shifty = 0.03*progress*cos(10.0*(progress+x));return vec2(0, shifty);}void main() {vec2 p = gl_FragCoord.xy / resolution.xy;gl_FragColor = mix(texture2D(from, p + offset(progress, p.x, 0.0)), texture2D(to, p + offset(1.0-progress, p.x, 3.14)), progress);}",uniforms:{},name:"Dreamy"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform vec3 color;uniform float colorPhase; void main() {vec2 p = gl_FragCoord.xy / resolution.xy;gl_FragColor = mix(mix(vec4(color, 1.0), texture2D(from, p), smoothstep(1.0-colorPhase, 0.0, progress)),mix(vec4(color, 1.0), texture2D(to,   p), smoothstep(    colorPhase, 1.0, progress)),progress);}",uniforms:{color:[0,0,0],colorPhase:.4},name:"fadecolor"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform float grayPhase;vec3 grayscale (vec3 color) {return vec3(0.2126*color.r + 0.7152*color.g + 0.0722*color.b);}void main() {vec2 p = gl_FragCoord.xy / resolution.xy;vec4 fc = texture2D(from, p);vec4 tc = texture2D(to, p);gl_FragColor = mix(mix(vec4(grayscale(fc.rgb), 1.0), texture2D(from, p), smoothstep(1.0-grayPhase, 0.0, progress)),mix(vec4(grayscale(tc.rgb), 1.0), texture2D(to,   p), smoothstep(    grayPhase, 1.0, progress)),progress);}",uniforms:{grayPhase:.3},name:"fadegrayscale"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform float flashPhase;uniform float flashIntensity;uniform float flashZoomEffect;const vec3 flashColor = vec3(1.0, 0.8, 0.3);const float flashVelocity = 3.0;void main() {vec2 p = gl_FragCoord.xy / resolution.xy;vec4 fc = texture2D(from, p);vec4 tc = texture2D(to, p);float intensity = mix(1.0, 2.0*distance(p, vec2(0.5, 0.5)), flashZoomEffect) * flashIntensity * pow(smoothstep(flashPhase, 0.0, distance(0.5, progress)), flashVelocity);vec4 c = mix(texture2D(from, p), texture2D(to, p), smoothstep(0.5*(1.0-flashPhase), 0.5*(1.0+flashPhase), progress));c += intensity * vec4(flashColor, 1.0);gl_FragColor = c;}",uniforms:{flashPhase:.3,flashIntensity:3,flashZoomEffect:.5},name:"flash"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform float size;uniform float zoom;uniform float colorSeparation;void main() {vec2 p = gl_FragCoord.xy / resolution.xy;float inv = 1. - progress;vec2 disp = size*vec2(cos(zoom*p.x), sin(zoom*p.y));vec4 texTo = texture2D(to, p + inv*disp);vec4 texFrom = vec4(texture2D(from, p + progress*disp*(1.0 - colorSeparation)).r,texture2D(from, p + progress*disp).g,texture2D(from, p + progress*disp*(1.0 + colorSeparation)).b,1.0);gl_FragColor = texTo*progress + texFrom*inv;}",uniforms:{size:.04,zoom:30,colorSeparation:.3},name:"flyeye"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;uniform float progress;uniform vec2 resolution;void main() {vec2 p = gl_FragCoord.xy / resolution.xy;vec4 a = texture2D(from, (p - vec2(progress, 0.0)) / vec2(1.0-progress, 1.0));vec4 b = texture2D(to, p / vec2(progress, 1.0));gl_FragColor = mix(a, b, step(p.x, progress));}",uniforms:{},name:"Fold"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;uniform float progress;uniform vec2 resolution;highp float random(vec2 co){highp float a = 12.9898;highp float b = 78.233;highp float c = 43758.5453;highp float dt= dot(co.xy ,vec2(a,b));highp float sn= mod(dt,3.14);return fract(sin(sn) * c);}float voronoi( in vec2 x ) {vec2 p = floor( x );vec2 f = fract( x );float res = 8.0;for( float j=-1.; j<=1.; j++ )for( float i=-1.; i<=1.; i++ ) {vec2  b = vec2( i, j );vec2  r = b - f + random( p + b );float d = dot( r, r );res = min( res, d );}return sqrt( res );}vec2 displace(vec4 tex, vec2 texCoord, float dotDepth, float textureDepth, float strength) {float b = voronoi(.003 * texCoord + 2.0);float g = voronoi(0.2 * texCoord);float r = voronoi(texCoord - 1.0);vec4 dt = tex * 1.0;vec4 dis = dt * dotDepth + 1.0 - tex * textureDepth;dis.x = dis.x - 1.0 + textureDepth*dotDepth;dis.y = dis.y - 1.0 + textureDepth*dotDepth;dis.x *= strength;dis.y *= strength;vec2 res_uv = texCoord ;res_uv.x = res_uv.x + dis.x - 0.0;res_uv.y = res_uv.y + dis.y;return res_uv;}float ease1(float t) {return t == 0.0 || t == 1.0? t: t < 0.5? +0.5 * pow(2.0, (20.0 * t) - 10.0): -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;}float ease2(float t) {return t == 1.0 ? t : 1.0 - pow(2.0, -10.0 * t);}void main() {vec2 p = gl_FragCoord.xy / resolution.xy;vec4 color1 = texture2D(from, p);vec4 color2 = texture2D(to, p);vec2 disp = displace(color1, p, 0.33, 0.7, 1.0-ease1(progress));vec2 disp2 = displace(color2, p, 0.33, 0.5, ease2(progress));vec4 dColor1 = texture2D(to, disp);vec4 dColor2 = texture2D(from, disp2);float val = ease1(progress);vec3 gray = vec3(dot(min(dColor2, dColor1).rgb, vec3(0.299, 0.587, 0.114)));dColor2 = vec4(gray, 1.0);dColor2 *= 2.0;color1 = mix(color1, dColor2, smoothstep(0.0, 0.5, progress));color2 = mix(color2, dColor1, smoothstep(1.0, 0.5, progress));gl_FragColor = mix(color1, color2, val);}",uniforms:{},name:"glitch displace"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;uniform float progress;uniform vec2 resolution;vec3 hsv2rgb(vec3 c) {const vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);}vec3 rgb2hsv(vec3 c) {const vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));float d = q.x - min(q.w, q.y);return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + 0.001)), d / (q.x + 0.001), q.x);}void main() {vec2 p = gl_FragCoord.xy / resolution.xy;vec3 a = rgb2hsv(texture2D(from, p).rgb);vec3 b = rgb2hsv(texture2D(to, p).rgb);vec3 m = mix(a, b, progress);gl_FragColor = vec4(hsv2rgb(m), 1.0);}",uniforms:{},name:"HSVfade"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;uniform float progress;uniform vec2 resolution;uniform float intensity;const int PASSES = 8;void main() {vec2 p = gl_FragCoord.xy / resolution.xy;vec4 c1 = vec4(0.0), c2 = vec4(0.0);float disp = intensity*(0.5-distance(0.5, progress));for (int xi=0; xi<PASSES; ++xi) {float x = float(xi) / float(PASSES) - 0.5;for (int yi=0; yi<PASSES; ++yi) {float y = float(yi) / float(PASSES) - 0.5;vec2 v = vec2(x,y);float d = disp;c1 += texture2D(from, p + d*v);c2 += texture2D(to, p + d*v);}}c1 /= float(PASSES*PASSES);c2 /= float(PASSES*PASSES);gl_FragColor = mix(c1, c2, progress);}",uniforms:{intensity:.1},name:"linearblur"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;uniform float progress;uniform vec2 resolution;const float strength=0.1;void main() {vec2 p = gl_FragCoord.xy / resolution.xy;vec4 ca = texture2D(from, p);vec4 cb = texture2D(to, p);vec2 oa = (((ca.rg+ca.b)*0.5)*2.0-1.0);vec2 ob = (((cb.rg+cb.b)*0.5)*2.0-1.0);vec2 oc = mix(oa,ob,0.5)*strength;float w0 = progress;float w1 = 1.0-w0;gl_FragColor = mix(texture2D(from, p+oc*w0), texture2D(to, p-oc*w1), progress);}",uniforms:{},name:"morph"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define PI 3.14159265358979323\n#define POW2(X) X*X\n#define POW3(X) X*X*X\nuniform sampler2D from, to;uniform float progress;uniform vec2 resolution;uniform int endx;uniform int endy;float Rand(vec2 v) {return fract(sin(dot(v.xy ,vec2(12.9898,78.233))) * 43758.5453);}vec2 Rotate(vec2 v, float a) {mat2 rm = mat2(cos(a), -sin(a),sin(a), cos(a));return rm*v;}float CosInterpolation(float x) {return -cos(x*PI)/2.+.5;}void main() {vec2 p = gl_FragCoord.xy / resolution.xy - .5;vec2 rp = p;float rpr = (progress*2.-1.);float z = -(rpr*rpr*2.) + 3.;float az = abs(z);rp *= az;rp += mix(vec2(.5, .5), vec2(float(endx) + .5, float(endy) + .5), POW2(CosInterpolation(progress)));vec2 mrp = mod(rp, 1.);vec2 crp = rp;bool onEnd = int(floor(crp.x))==endx&&int(floor(crp.y))==endy;if(!onEnd) {float ang = float(int(Rand(floor(crp))*4.))*.5*PI;mrp = vec2(.5) + Rotate(mrp-vec2(.5), ang);}if(onEnd || Rand(floor(crp))>.5) {gl_FragColor = texture2D(to, mrp);} else {gl_FragColor = texture2D(from, mrp);}}",uniforms:{endx:0,endy:-1},name:"Mosaic"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from,to;uniform float progress;uniform vec2 resolution;const float MIN_AMOUNT=-0.16;const float MAX_AMOUNT=1.3;float amount=progress*(MAX_AMOUNT-MIN_AMOUNT)+MIN_AMOUNT;const float PI=3.141592653589793;const float scale=512.0;const float sharpness=3.0;float cylinderCenter=amount;float cylinderAngle=2.0*PI*amount;const float cylinderRadius=1.0/PI/2.0;vec3 hitPoint(float hitAngle,float yc,vec3 point,mat3 rrotation){float hitPoint=hitAngle/(2.0*PI);point.y=hitPoint;return rrotation*point;}vec4 antiAlias(vec4 color1,vec4 color2,float distanc){distanc*=scale;if(distanc<0.0) return color2;if(distanc>2.0) return color1;float dd=pow(1.0-distanc/2.0,sharpness);return ((color2-color1)*dd)+color1;}float distanceToEdge(vec3 point){float dx=abs(point.x>0.5?1.0-point.x:point.x);float dy=abs(point.y>0.5?1.0-point.y:point.y);if(point.x<0.0) dx=-point.x;if(point.x>1.0) dx=point.x-1.0;if(point.y<0.0) dy=-point.y;if(point.y>1.0) dy=point.y-1.0;if((point.x<0.0||point.x>1.0)&&(point.y<0.0||point.y>1.0)) return sqrt(dx*dx+dy*dy);return min(dx,dy);}vec4 seeThrough(float yc,vec2 p,mat3 rotation,mat3 rrotation){float hitAngle=PI-(acos(yc/cylinderRadius)-cylinderAngle);vec3 point=hitPoint(hitAngle,yc,rotation*vec3(p,1.0),rrotation);if(yc<=0.0&&(point.x<0.0||point.y<0.0||point.x>1.0||point.y>1.0)){vec2 texCoord=gl_FragCoord.xy/resolution.xy;return texture2D(to,texCoord);}if(yc>0.0) return texture2D(from,p);vec4 color=texture2D(from,point.xy);vec4 tcolor=vec4(0.0);return antiAlias(color,tcolor,distanceToEdge(point));}vec4 seeThroughWithShadow(float yc,vec2 p,vec3 point,mat3 rotation,mat3 rrotation){float shadow=distanceToEdge(point)*30.0;shadow=(1.0-shadow)/3.0;if(shadow<0.0) shadow=0.0;else shadow*=amount;vec4 shadowColor=seeThrough(yc,p,rotation,rrotation);shadowColor.r-=shadow;shadowColor.g-=shadow;shadowColor.b-=shadow;return shadowColor;}vec4 backside(float yc,vec3 point){vec4 color=texture2D(from,point.xy);float gray=(color.r+color.b+color.g)/15.0;gray+=(8.0/10.0)*(pow(1.0-abs(yc/cylinderRadius),2.0/10.0)/2.0+(5.0/10.0));color.rgb=vec3(gray);return color;}vec4 behindSurface(float yc,vec3 point,mat3 rrotation){float shado=(1.0-((-cylinderRadius-yc)/amount*7.0))/6.0;shado*=1.0-abs(point.x-0.5);yc=(-cylinderRadius-cylinderRadius-yc);float hitAngle=(acos(yc/cylinderRadius)+cylinderAngle)-PI;point=hitPoint(hitAngle,yc,point,rrotation);if(yc<0.0&&point.x>=0.0&&point.y>=0.0&&point.x<=1.0&&point.y<=1.0&&(hitAngle<PI||amount>0.5)){shado=1.0-(sqrt(pow(point.x-0.5,2.0)+pow(point.y-0.5,2.0))/(71.0/100.0));shado*=pow(-yc/cylinderRadius,3.0);shado*=0.5;}else{shado=0.0;}vec2 texCoord=gl_FragCoord.xy/resolution.xy;return vec4(texture2D(to,texCoord).rgb-shado,1.0);}void main(){vec2 texCoord=gl_FragCoord.xy/resolution.xy;const float angle=30.0*PI/180.0;float c=cos(-angle);float s=sin(-angle);mat3 rotation=mat3(c,s,0,-s,c,0,0.12,0.258,1);c=cos(angle);s=sin(angle);mat3 rrotation=mat3(c,s,0,-s,c,0,0.15,-0.5,1);vec3 point=rotation*vec3(texCoord,1.0);float yc=point.y-cylinderCenter;if(yc<-cylinderRadius){gl_FragColor=behindSurface(yc,point,rrotation);return;}if(yc>cylinderRadius){gl_FragColor=texture2D(from,texCoord);return;}float hitAngle=(acos(yc/cylinderRadius)+cylinderAngle)-PI;float hitAngleMod=mod(hitAngle,2.0*PI);if((hitAngleMod>PI&&amount<0.5)||(hitAngleMod>PI/2.0&&amount<0.0)){gl_FragColor=seeThrough(yc,texCoord,rotation,rrotation);return;}point=hitPoint(hitAngle,yc,point,rrotation);if(point.x<0.0||point.y<0.0||point.x>1.0||point.y>1.0){gl_FragColor=seeThroughWithShadow(yc,texCoord,point,rotation,rrotation);return;}vec4 color=backside(yc,point);vec4 otherColor;if(yc<0.0){float shado=1.0-(sqrt(pow(point.x-0.5,2.0)+pow(point.y-0.5,2.0))/0.71);shado*=pow(-yc/cylinderRadius,3.0);shado*=0.5;otherColor=vec4(0.0,0.0,0.0,shado);}else{otherColor=texture2D(from,texCoord);}color=antiAlias(color,otherColor,cylinderRadius-abs(yc));vec4 cl=seeThroughWithShadow(yc,texCoord,point,rotation,rrotation);float dist=distanceToEdge(point);gl_FragColor=antiAlias(color,cl,dist);}",uniforms:{},name:"PageCurl"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;uniform float progress;uniform vec2 resolution;void main() {  vec2 p = gl_FragCoord.xy / resolution.xy;  float circPos = atan(p.y - 0.5, p.x - 0.5) + progress;  float modPos = mod(circPos, 3.1415 / 4.);  float signed = sign(progress - modPos);  float smoothed = smoothstep(0., 1., signed);if (smoothed > 0.5){gl_FragColor = texture2D(to, p);} else {gl_FragColor = texture2D(from, p);}}",uniforms:{},name:"pinwheel"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform ivec2 size;uniform float smoothness;float rand (vec2 co) {return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);}void main() {vec2 p = gl_FragCoord.xy / resolution.xy;float r = rand(floor(vec2(size) * p));float m = smoothstep(0.0, -smoothness, r - (progress * (1.0 + smoothness)));gl_FragColor = mix(texture2D(from, p), texture2D(to, p), m);}",uniforms:{size:[10,10],smoothness:.5},name:"randomSquares"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform float amplitude;uniform float speed;void main(){vec2 p=gl_FragCoord.xy/resolution.xy;vec2 dir=p-vec2(.5);float dist=length(dir);vec2 offset=dir*(sin(progress*dist*amplitude-progress*speed)+.5)/30.;gl_FragColor=mix(texture2D(from,p+offset),texture2D(to,p),smoothstep(0.2,1.0,progress));}",uniforms:{amplitude:100,speed:50},name:"ripple"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;uniform float progress;uniform vec2 resolution;uniform float translateX;uniform float translateY;void main() {vec2 texCoord = gl_FragCoord.xy / resolution.xy;float x = progress * translateX;float y = progress * translateY;if (x >= 0.0 && y >= 0.0) {if (texCoord.x >= x && texCoord.y >= y) {gl_FragColor = texture2D(from, texCoord - vec2(x, y));}else {vec2 uv;if (x > 0.0)uv = vec2(x - 1.0, y);else if (y > 0.0)uv = vec2(x, y - 1.0);gl_FragColor = texture2D(to, texCoord - uv);}}else if (x <= 0.0 && y <= 0.0) {if (texCoord.x <= (1.0 + x) && texCoord.y <= (1.0 + y))gl_FragColor = texture2D(from, texCoord - vec2(x, y));else {vec2 uv;if (x < 0.0)uv = vec2(x + 1.0, y);else if (y < 0.0)uv = vec2(x, y + 1.0);gl_FragColor = texture2D(to, texCoord - uv);}}else\ngl_FragColor = vec4(0.0);}",uniforms:{translateX:1,translateY:0},name:"Slide"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;uniform float progress;uniform vec2 resolution;uniform float translateX;uniform float translateY;void main() {vec2 texCoord = gl_FragCoord.xy / resolution.xy;float x = progress * translateX;float y = progress * translateY;if (x >= 0.0 && y >= 0.0) {if (texCoord.x >= x && texCoord.y >= y) {gl_FragColor = texture2D(from, texCoord - vec2(x, y));}else {vec2 uv;if (x > 0.0)uv = vec2(x - 1.0, y);else if (y > 0.0)uv = vec2(x, y - 1.0);gl_FragColor = texture2D(to, texCoord - uv);}}else if (x <= 0.0 && y <= 0.0) {if (texCoord.x <= (1.0 + x) && texCoord.y <= (1.0 + y))gl_FragColor = texture2D(from, texCoord - vec2(x, y));else {vec2 uv;if (x < 0.0)uv = vec2(x + 1.0, y);else if (y < 0.0)uv = vec2(x, y + 1.0);gl_FragColor = texture2D(to, texCoord - uv);}}else\ngl_FragColor = vec4(0.0);}",uniforms:{translateX:-1,translateY:0},name:"Slide -1x0"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;uniform float progress;uniform vec2 resolution;uniform ivec2 squares;uniform vec2 direction;uniform float smoothness;const vec2 center = vec2(0.5, 0.5);void main() {vec2 p = gl_FragCoord.xy / resolution.xy;vec2 v = normalize(direction);if (v != vec2(0.0))v /= abs(v.x)+abs(v.y);float d = v.x * center.x + v.y * center.y;float offset = smoothness;float pr = smoothstep(-offset, 0.0, v.x * p.x + v.y * p.y - (d-0.5+progress*(1.+offset)));vec2 squarep = fract(p*vec2(squares));vec2 squaremin = vec2(pr/2.0);vec2 squaremax = vec2(1.0 - pr/2.0);float a = all(lessThan(squaremin, squarep)) && all(lessThan(squarep, squaremax)) ? 1.0 : 0.0;gl_FragColor = mix(texture2D(from, p), texture2D(to, p), a);}",uniforms:{squares:[10,10],direction:[1,-.5],smoothness:1.6},name:"squareswipe"},{glsl:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform float colorSeparation;float progressY (float y) {return 0.5 + (y-0.5) / (1.0-progress);}void main() {vec2 p = gl_FragCoord.xy / resolution.xy;float y = progressY(p.y);if (y < 0.0 || y > 1.0) {gl_FragColor = texture2D(to, p);}else {vec2 fp = vec2(p.x, y);vec3 c = vec3(texture2D(from, fp - progress*vec2(0.0, colorSeparation)).r,texture2D(from, fp).g,texture2D(from, fp + progress*vec2(0.0, colorSeparation)).b);gl_FragColor = vec4(c, 1.0);}}",uniforms:{colorSeparation:.02},name:"squeeze"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform float reflection;uniform float perspective;uniform float depth;const vec4 black=vec4(0.0,0.0,0.0,1.0);const vec2 boundMin=vec2(0.0,0.0);const vec2 boundMax=vec2(1.0,1.0);bool inBounds(vec2 p){return all(lessThan(boundMin,p))&&all(lessThan(p,boundMax));}vec2 project(vec2 p){return p*vec2(1.0,-1.2)+vec2(0.0,-0.02);}vec4 bgColor(vec2 p,vec2 pfr,vec2 pto){vec4 c=black;pfr=project(pfr);if(inBounds(pfr)){c+=mix(black,texture2D(from,pfr),reflection*mix(1.0,0.0,pfr.y));}pto=project(pto);if(inBounds(pto)){c+=mix(black,texture2D(to,pto),reflection*mix(1.0,0.0,pto.y));}return c;}void main(){vec2 p=gl_FragCoord.xy/resolution.xy;vec2 pfr,pto=vec2(-1.);float size=mix(1.0,depth,progress);float persp=perspective*progress;pfr=(p+vec2(-0.0,-0.5))*vec2(size/(1.0-perspective*progress),size/(1.0-size*persp*p.x))+vec2(0.0,0.5);size=mix(1.0,depth,1.-progress);persp=perspective*(1.-progress);pto=(p+vec2(-1.0,-0.5))*vec2(size/(1.0-perspective*(1.0-progress)),size/(1.0-size*persp*(0.5-p.x)))+vec2(1.0,0.5);bool fromOver=progress<0.5;if(fromOver){if(inBounds(pfr)){gl_FragColor=texture2D(from,pfr);}else if(inBounds(pto)){gl_FragColor=texture2D(to,pto);}else{gl_FragColor=bgColor(p,pfr,pto);}}else{if(inBounds(pto)){gl_FragColor=texture2D(to,pto);}else if(inBounds(pfr)){gl_FragColor=texture2D(from,pfr);}else{gl_FragColor=bgColor(p,pfr,pto);}}}",uniforms:{reflection:.4,perspective:.2,depth:3},name:"swap"},{glsl:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;uniform float progress;uniform vec2 resolution;void main() {vec2 p = gl_FragCoord.xy / resolution.xy;gl_FragColor = mix(texture2D(from, p), texture2D(to, p), progress);}",uniforms:{},name:"test"},{glsl:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from, to;uniform float progress;uniform vec2 resolution;uniform vec2 tileSize;uniform float checkerDistance;uniform bool flipX;uniform bool flipY;uniform bool preTileSingleColor;uniform bool postTileSingleColor;vec2 tile2Global(vec2 tex, vec2 tileNum, bool tileSingleColor) {vec2 perTile = tileSize / resolution.xy;return tileNum * perTile + (tileSingleColor ? vec2(0) : tex*perTile);}void main(void){vec2 uv = gl_FragCoord.xy / resolution.xy;vec4 fragColor = vec4(1, 1, 0, 1);vec2 posInTile = mod(vec2(gl_FragCoord), tileSize);vec2 tileNum = floor(vec2(gl_FragCoord)/ tileSize);int num = int(tileNum.x);vec2 totalTiles = ceil(resolution.xy / tileSize);float countTiles = totalTiles.x * totalTiles.y;vec2 perTile = ceil(tileSize / resolution.xy);float offset = 0.0;offset = (tileNum.y + tileNum.x * perTile.y) / (sqrt(countTiles) * 2.0);float timeOffset = (progress - offset) * countTiles;timeOffset = clamp(timeOffset, 0.0, 0.5);float sinTime = 1.0 - abs(cos(fract(timeOffset) * 3.1415926));fragColor.rg = uv;fragColor.b = sinTime;vec2 texC = posInTile / tileSize;if (sinTime <= 0.5){if (flipX) {if ((texC.x < sinTime) || (texC.x > 1.0 - sinTime)){discard;}if (texC.x < 0.5) {texC.x = (texC.x - sinTime) * 0.5 / (0.5 - sinTime);} else {texC.x = (texC.x - 0.5) * 0.5 / (0.5 - sinTime) + 0.5;}}if (flipY) {if ((texC.y < sinTime) || (texC.y > 1.0 - sinTime)){discard;}if (texC.y < 0.5) {texC.y = (texC.y - sinTime) * 0.5 / (0.5 - sinTime);} else {texC.y = (texC.y - 0.5) * 0.5 / (0.5 - sinTime) + 0.5;}}fragColor = texture2D(from, tile2Global(texC, tileNum, preTileSingleColor));} else {if (flipX) {if ((texC.x > sinTime) || (texC.x < 1.0 - sinTime)){discard;}if (texC.x < 0.5) {texC.x = (texC.x - sinTime) * 0.5 / (0.5 - sinTime);} else {texC.x = (texC.x - 0.5) * 0.5 / (0.5 - sinTime) + 0.5;}texC.x = 1.0 - texC.x;}if (flipY) {if ((texC.y > sinTime) || (texC.y < 1.0 - sinTime)){discard;}if (texC.y < 0.5) {texC.y = (texC.y - sinTime) * 0.5 / (0.5 - sinTime);} else {texC.y = (texC.y - 0.5) * 0.5 / (0.5 - sinTime) + 0.5;}texC.y = 1.0 - texC.y;}fragColor.rgb = texture2D(to, tile2Global(texC, tileNum, postTileSingleColor)).rgb;}gl_FragColor = fragColor;}",uniforms:{tileSize:[64,64],checkerDistance:0,flipX:!1,flipY:!1,preTileSingleColor:!1,postTileSingleColor:!1},name:"TilesWaveBottomLeftToTopRight"},{glsl:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\n#define 	M_PI   3.14159265358979323846	\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform float smoothness;const vec2 center=vec2(0.5,0.5);float quadraticInOut(float t){float p=2.0*t*t;return t<0.5?p:-p+(4.0*t)-1.0;}float linearInterp(vec2 range,vec2 domain,float x){return mix(range.x,range.y,smoothstep(domain.x,domain.y,clamp(x,domain.x,domain.y)));}float getGradient(float r,float dist){float grad=smoothstep(-smoothness,0.0,r-dist*(1.0+smoothness));if(r-dist<0.005&&r-dist>-0.005){return -1.0;}else if(r-dist<0.01&&r-dist>-0.005){return -2.0;}return grad;}float round(float a){return floor(a+0.5);}float getWave(vec2 p){vec2 _p=p-center;float rads=atan(_p.y,_p.x);float degs=degrees(rads)+180.0;vec2 range=vec2(0.0,M_PI*30.0);vec2 domain=vec2(0.0,360.0);float ratio=(M_PI*30.0)/360.0;degs=degs*ratio;float x=progress;float magnitude=mix(0.02,0.09,smoothstep(0.0,1.0,x));float offset=mix(40.0,30.0,smoothstep(0.0,1.0,x));float ease_degs=quadraticInOut(sin(degs));float deg_wave_pos=(ease_degs*magnitude)*sin(x*offset);return x+deg_wave_pos;}void main(){vec2 p=gl_FragCoord.xy/resolution.xy;if(progress==0.0){gl_FragColor=texture2D(from,p);}else if(progress==1.0){gl_FragColor=texture2D(to,p);}else{float dist=distance(center,p);float m=getGradient(getWave(p),dist);if(m==-2.0){gl_FragColor=mix(texture2D(from,p),vec4(0.0,0.0,0.0,1.0),0.75);}else{gl_FragColor=mix(texture2D(from,p),texture2D(to,p),m);}}}",uniforms:{smoothness:.02},name:"undulating burn out"},{glsl:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D from;uniform sampler2D to;uniform float progress;uniform vec2 resolution;uniform float size;float rand (vec2 co) {return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);}void main() {vec2 p = gl_FragCoord.xy / resolution.xy;float r = rand(vec2(0, p.y));float m = smoothstep(0.0, -size, p.x*(1.0-size) + size*r - (progress * (1.0 + size)));gl_FragColor = mix(texture2D(from, p), texture2D(to, p), m);}",uniforms:{size:.2},name:"wind"}],n={cursor:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAATSURBVHjaYvj//z8DAAAA//8DAAj8Av7TpXVhAAAAAElFTkSuQmCC) 25 25, no-drop"},a={cursor:"pointer"},s="./image/loading2-32.gif",l="./ajax/like_image_submit.php",c="./ajax/like_image_submit.php";
t.prototype={constructor:t,getDiaporamaTimelineData:function(e,o,t,i){var n,a,s,l,c,f,p=this,u=[],m={},d=r.length,v=p.options.maxTransitionTime,g=p.options.minTransitionTime,x=p.options.maxSlideTime,h=p.options.minSlideTime,y=v-g,C=x-h,_=p.options.maxEasing,D=p.options.minEasing,S=_-D,w=p.options.minKenburnsRatio;i===undefined&&(i=!0);for(var b=0,T=e.length;T>b;b++)e[b].width||(e[b].width=o),e[b].height||(e[b].height=t),n=o/e[b].width,a=t/e[b].height,s=Math.max(Math.min(Math.max(n,a),.9),w),l=Math.floor(2*Math.random()),l?(c=1,f=s):(c=s,f=1),m.kenburns={easing:[D+Math.random()*S,D+Math.random()*S,D+Math.random()*S,D+Math.random()*S],from:[c,[Math.random(),Math.random()]],to:[f,[Math.random(),Math.random()]]},m.image=e[b].imageSrc,m.duration=h+Math.floor(Math.random()*C),i&&(m.transitionNext={name:r[Math.floor(Math.random()*d)].name,duration:g+Math.floor(Math.random()*y)}),u.push(m),m={};return u},_fullscreen:function(){var e={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",element:null,prefix:""},o="webkit moz o ms khtml".split(" ");if(document.cancelFullScreen!==undefined)e.supportsFullScreen=!0;else for(var t=0,i=o.length;i>t;t++){if(e.prefix=o[t],document[e.prefix+"CancelFullScreen"]!==undefined){e.supportsFullScreen=!0;break}if(document.msExitFullscreen!==undefined&&document.msFullscreenEnabled){e.prefix="ms",e.supportsFullScreen=!0;break}}return"webkit"===e.prefix&&navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)&&(e.supportsFullScreen=!1),e.supportsFullScreen&&(e.fullScreenEventName="ms"==e.prefix?"MSFullscreenChange":e.prefix+"fullscreenchange",e.isFullScreen=function(e){switch(e===undefined&&(e=document),this.prefix){case"":return document.fullscreenElement==e;case"moz":return document.mozFullScreenElement==e;default:return document[this.prefix+"FullscreenElement"]==e}},e.requestFullScreen=function(e){return""===this.prefix?e.requestFullScreen():e[this.prefix+("ms"==this.prefix?"RequestFullscreen":"RequestFullScreen")]("webkit"===this.prefix?e.ALLOW_KEYBOARD_INPUT:null)},e.cancelFullScreen=function(){return""===this.prefix?document.cancelFullScreen():document[this.prefix+("ms"==this.prefix?"ExitFullscreen":"CancelFullScreen")]()},e.element=function(){return""===this.prefix?document.fullscreenElement:document[this.prefix+"FullscreenElement"]}),e},_storage:function(){var e={supported:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}()};return e},_browserSniff:function(){var e,o,t,i=navigator.userAgent,r=navigator.appName,n=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10);return-1!==navigator.appVersion.indexOf("Windows NT")&&-1!==navigator.appVersion.indexOf("rv:11")?(r="IE",n="11;"):-1!==(o=i.indexOf("MSIE"))?(r="IE",n=i.substring(o+5)):-1!==(o=i.indexOf("Chrome"))?(r="Chrome",n=i.substring(o+7)):-1!==(o=i.indexOf("Safari"))?(r="Safari",n=i.substring(o+7),-1!==(o=i.indexOf("Version"))&&(n=i.substring(o+8))):-1!==(o=i.indexOf("Firefox"))?(r="Firefox",n=i.substring(o+8)):(e=i.lastIndexOf(" ")+1)<(o=i.lastIndexOf("/"))&&(r=i.substring(e,o),n=i.substring(o+1),r.toLowerCase()==r.toUpperCase()&&(r=navigator.appName)),-1!==(t=n.indexOf(";"))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(" "))&&(n=n.substring(0,t)),a=parseInt(""+n,10),isNaN(a)&&(n=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10)),{name:r,version:a,ios:/(iPad|iPhone|iPod)/g.test(navigator.platform)}},_init:function(){var e=this;e._initView(),e._initContainer(),e._initDiaporama(),e._initInfoComponent(),e._initRateComponent(),e._initList(),e._initActions(),e._initButtons(),e._initImageActions(),e._addKeyboardEvent(),e.$clickSection.on("click",function(o){e._onClickPlayBtn(o)}),e.$iplayer.on("mousemove.iplayer",function(o){e._onMousemove(o)}),e.options.diaporama.autoplay||(e.$playBtn.addClass("icon-iplayer-play"),e.$playBtn.removeClass("icon-iplayer-pause"))},_initView:function(){var e=this;e._initViewContainer(),e._initViewInfo(),e._initViewRate(),e._initViewActions(),e._initViewList()},_initViewContainer:function(){e("#iplayer").length||e("body").append('<div id="iplayer"></div>');var o=this,t=['<div id="diaporama"></div>','<div id="iplayer-handle">','<div id="iplayer-click-section"></div>','<a class="iplayer-close-btn" id="js-iplayer-close-btn"><span>X</span></a>','<a class="iplayer-prev-btn icon-iplayer icon-iplayer-prev-large" id="js-iplayer-prev-btn"></a>','<a class="iplayer-next-btn icon-iplayer icon-iplayer-next-large" id="js-iplayer-next-btn"></a>','<img id="iplayer-loading" src="'+s+'" style="display: none;">','<div id="iplayer-share-code-section">','<textarea class="form-control" rows="3" id="js-iplayer-share-code-input"></textarea>',"</div>"];o.options.showLogo&&t.push('<a id="iplayer-logo" href="/" target="_blank"></a>'),t.push('<div id="iplayer-bottom">','<div id="iplayer-bottom-wrap"></div>','<div class="iplayer-progress">','<div class="iplayer-progress-inner" id="js-iplayer-progress">','<div class="iplayer-progress-playing" style="width: 0%;"></div>',"</div>",'<div class="iplayer-progress-panel" id="js-iplayer-panel">','<a class="iplayer-dot icon-iplayer icon-iplayer-dot-large" id="js-iplayer-dot" style="left: 0%;"></a>',"</div>","</div>","</div>","</div>"),e("#iplayer").html(t.join(""))},_initViewInfo:function(){var o=this,t=['<div class="iplayer-controls">','<a id="js-iplayer-play-btn" class="iplayer-play-btn icon-iplayer icon-iplayer-pause"></a>',"</div>",'<div class="iplayer-info">','<div class="iplayer-length">','<span class="iplayer-position" id="js-iplayer-position-num">1</span>/<span class="iplayer-duration" id="js-iplayer-duration-num">{{itemsCount}}</span>',"</div>",'<div class="iplayer-image">','<div id="js-iplayer-image-info" class="iplayer-image-info">','<a id="js-iplayer-image-title" href="{{titleSrc}}" title="{{title}}" target="_blank">{{title}}</a>',"-",'<a id="js-iplayer-image-author" href="{{authorSrc}}" title="{{author}}" target="_blank">{{author}}</a>',"</div>","</div>",'<div class="iplayer-image-controls">','<a id="js-iplayer-like-btn" class="icon-iplayer icon-iplayer-like {{likeActiveClass}}" data-image-id="{{imageId}}" title="收藏"></a>',"</div>","</div>"].join("");t=t.replace(/\{\{title\}\}/g,o.originTimelineData[0].title).replace(/\{\{titleSrc\}\}/g,o.originTimelineData[0].titleSrc).replace(/\{\{author\}\}/g,o.originTimelineData[0].author).replace(/\{\{authorSrc\}\}/g,o.originTimelineData[0].authorSrc).replace(/\{\{imageId\}\}/g,o.originTimelineData[0].id).replace(/\{\{itemsCount\}\}/g,o.originTimelineData.length),t=o.originTimelineData[0].liked?t.replace(/\{\{likeActiveClass\}\}/g,"active"):t.replace(/\{\{likeActiveClass\}\}/g,""),e("#iplayer-bottom-wrap").html(t)},_initViewRate:function(){var o=['<div class="iplayer-rate">','<div id="iplayer-rate-info">','<div class="iplayer-rate-wrap" id="js-iplayer-rate-range">','<div id="iplayer-rate-value">',"<span>1.0</span>","</div>",'<div class="iplayer-rate-panel">','<div class="iplayer-rate-image" id="iplayer-rate-bar" style="width: 50%;">',"</div>","</div>",'<div class="iplayer-rate-control">','<a class="iplayer-rate-dot icon-iplayer icon-iplayer-dot" style="left: 50%;">',"</a>","</div>","</div>","</div>","</div>"].join("");e("#iplayer-bottom-wrap").append(o)},_initViewActions:function(){var o=['<div class="iplayer-actions">','<a title="全屏播放" id="js-iplayer-fullscreen" class="iplayer-fullscreen icon-iplayer icon-iplayer-fullscreen"></a>','<a title="显示播放列表" id="js-iplayer-show-list" class="iplayer-show-list icon-iplayer icon-iplayer-show-list"></a>','<a title="取消特效" id="js-iplayer-display-transitions" class="iplayer-display-transitions icon-iplayer icon-iplayer-display-transitions active"></a>','<a title="分享播放器代码" id="js-iplayer-share-code" class="iplayer-share-code icon-iplayer icon-iplayer-share"></a>',"</div>"].join("");e("#iplayer-bottom-wrap").append(o)},_initViewList:function(){var o=['<div id="iplayer-list" >','<a class="iplayer-list-prev-btn icon-iplayer icon-iplayer-prev-medium" id="js-iplayer-list-prev-btn"></a>','<a class="iplayer-list-next-btn icon-iplayer icon-iplayer-next-medium" id="js-iplayer-list-next-btn"></a>','<div class="iplayer-list-content" id="js-iplayer-list-content">','<div class="iplayer-list-inner" id="js-iplayer-list-inner">','<div class="iplayer-list-container" id="js-iplayer-list-container"></div>',"</div>","</div>","</div>"].join("");e("#iplayer-bottom").append(o)},_initContainer:function(){var o=this;e(document.body).css({overflow:"hidden"}),o.$iplayer=e("#iplayer"),o.$list=e("#iplayer-list"),o.$diaporama=e("#diaporama"),o.$handle=e("#iplayer-handle"),o.$clickSection=e("#iplayer-click-section"),o.$bottom=e("#iplayer-bottom"),o.$loading=e("#iplayer-loading"),o.$logo=e("#iplayer-logo")},_initDiaporama:function(){var t=this,i=document.getElementById("diaporama"),r=e(window),n=r.width(),a=r.height();t.playByNoDiaporama=!1,t.diaporamaData.timeline=t.getDiaporamaTimelineData(t.originTimelineData,n,a,t.state.displayTransitions),t.transitionTimelineData=t.diaporamaData.timeline,t.diaporama=o(i,t.diaporamaData,t.options.diaporama),t._addDiaporamaEvent()},_addDiaporamaEvent:function(){var o=this;e(window).on("resize.iplayer",function(e){o._onWindowResize(e)}),o._onWindowResize(),o.diaporama.addListener("transition",function(e){o._onDiaporamaTransition(e)}),o.diaporama.addListener("slide",function(e){o._onDiaporamaSlide(e)})},_removeDiaporamaEvent:function(){var o=this;e(window).off("resize.iplayer"),o.diaporama.removeListener("transition"),o.diaporama.removeListener("slide")},_onWindowResize:function(){var e=this,o=window.innerWidth,t=window.innerHeight,i=524288;e.diaporama.width=o,e.diaporama.height=t,e.diaporama.resolution=Math.min(window.devicePixelRatio||1,Math.ceil(i/(o*t)))},_onDiaporamaTransition:function(){var e=this;e.playByNoDiaporama||e._updatePlayPosition(e.currentIndex+1),e.playByNoDiaporama=!1},_onDiaporamaSlide:function(){var e=this;e.state.displayTransitions||e.playByNoDiaporama||e._updatePlayPosition(e.currentIndex+1),e.playByNoDiaporama=!1},_showLoading:function(){var e=this;e.$loading.show()},_hideLoading:function(){var e=this;e.$loading.hide()},_initInfoComponent:function(){var o=this;o.$infoTitle=e("#js-iplayer-image-title"),o.$infoAuthor=e("#js-iplayer-image-author"),o.$positionNum=e("#js-iplayer-position-num"),o.$durationNum=e("#js-iplayer-duration-num"),o.$infoProgress=e("#js-iplayer-progress"),o.$infoPanel=e("#js-iplayer-panel"),o.$infoSlider=e("#js-iplayer-dot"),o.$infoPlaying=o.$infoProgress.find(".iplayer-progress-playing"),o.infoMouseOffset=null,o.infoSliderDragging=!1,o.positionValue=0,o._addInfoEvent()},_addInfoEvent:function(){var o=this;o.$infoSlider.on("mousedown",function(e){o._infoSliderMouseDown(e)}),o.$infoPanel.on("click",function(e){e.target==e.currentTarget&&o._infoPanelMouseClick(e)}),e(document).on("mouseup.iplayer",function(e){o.infoSliderDragging&&o._infoMouseUp(e)}),e(document).on("mousemove.iplayer",function(e){o.infoSliderDragging&&o._infoMouseDrag(e)})},_removeInfoEvent:function(){var o=this;o.$infoSlider.off("mousedown"),o.$infoPanel.off("click"),e(document).off("mouseup.iplayer"),e(document).off("mousemove.iplayer")},_infoSliderMouseDown:function(e){var o=this;return o.infoSliderDragging=!0,o.infoMouseOffset={left:e.offsetX||e.pageX-o.$infoSlider.offset().left},!1},_infoPanelMouseClick:function(e){var o,t=this,i={left:e.offsetX||e.pageX-t.$infoPanel.offset().left},r=i.left/t.$infoPanel.width();return t.positionValue=r,o=Math.floor(t.positionValue*(t.itemsCount-1)),t.next(o),!1},_infoMouseUp:function(){var e,o=this;return e=Math.floor(o.positionValue*(o.itemsCount-1)),o.infoSliderDragging=!1,o.infoMouseOffset=null,o.next(e),!1},_infoMouseDrag:function(e){var o=this;return null!==o.infoMouseOffset?void o._calcInfoWidthFromMouseX({left:e.pageX}):!1},_calcInfoWidthFromMouseX:function(e){var o=this,t=o.$infoPanel.offset(),i=o.$infoPanel.width(),r=e.left-t.left;0>r&&(r=0),r>i&&(r=i);var n=r/i;Math.floor(n*(o.itemsCount-1)),o.positionValue=n,o.setPosition(n)},setPosition:function(e){var o=this;o.$positionNum.text(o.currentIndex+1),o.$infoSlider.css("left",100*e+"%"),o.$infoPlaying.width(100*e+"%")},resetPosition:function(){var e=this;e.$infoSlider.css("left","0%"),e.$infoPlaying.width("0%"),e.$positionNum.text(1),e.$durationNum.text(e.itemsCount)},_initRateComponent:function(){var o=this,t=e("#iplayer-rate-info");o.curRateValue=1,o.$rateWrap=e("#js-iplayer-rate-range"),o.$curRateValue=e("#iplayer-rate-value").find("span"),o.$rateDot=t.find(".iplayer-rate-dot"),o.$rateControl=t.find(".iplayer-rate-control"),o.$rateProgressBar=e("#iplayer-rate-bar"),o.rateSliderDragging=!1,o.rateMouseOffset=null,o.rateTimer=null,o._addRateEvent()},_addRateEvent:function(){var o=this;o.$rateDot.on("mousedown",function(e){o._rateMouseDown(e)}),o.$rateControl.on("click",function(e){e.target==e.currentTarget&&o._rateMouseClick(e)}),e(document).on("mouseup.iplayer",function(e){o.rateSliderDragging&&o._rateMouseUp(e)}),e(document).on("mousemove.iplayer",function(e){o.rateSliderDragging&&o._rateMouseDrag(e)})},_removeRateEvent:function(){var o=this;o.$rateDot.off("mousedown"),o.$rateControl.off("click"),e(document).off("mouseup.iplayer"),e(document).off("mousemove.iplayer")},_rateMouseDown:function(e){var o=this;return o.rateSliderDragging=!0,o.rateMouseOffset={left:e.offsetX||e.pageX-o.dot.offset().left},!1},_rateMouseUp:function(){var e=this;e.rateSliderDragging=!1,e.rateMouseOffset=null},_rateMouseDrag:function(e){var o=this;return null!==o.rateMouseOffset?void o._calcRateWidthFromMouseX({left:e.pageX}):!1},_rateMouseClick:function(e){var o=this,t={left:e.offsetX||e.pageX-o.$rateControl.offset().left},i=t.left/o.$rateControl.width(),r=i>=.5?1+2*(i-.5)*(o.options.maxPlaybackRate-1):2*i*(1-o.options.minPlaybackRate)+o.options.minPlaybackRate;return r=Number(r).toFixed(1),r===o.curRateValue?!1:(o.setRate(r),!1)},_calcRateWidthFromMouseX:function(e){var o=this,t=o.$rateWrap.offset(),i=o.$rateWrap.width()-8,r=o.rateMouseOffset.left,n=e.left-r-t.left;0>n&&(n=0),n>i&&(n=i);var a=n/i,s=a>=.5?1+2*(a-.5)*(o.options.maxPlaybackRate-1):2*a*(1-o.options.minPlaybackRate)+o.options.minPlaybackRate;return s=Number(s.toFixed(1)),s===o.curRateValue?!1:(o.rateUI(s),o.rateTimer&&clearTimeout(o.rateTimer),void(o.rateTimer=setTimeout(function(){o.setRate(s)},200)))},setRate:function(e){var o=this,e=Number(e).toFixed(1);return e===o.curRateValue?!1:(o.curRateValue=e,o.diaporama.playbackRate=e,o.state.playbackRate=e,void o.rateUI(e))},rateUI:function(e){var o,t=this,i=t.$rateControl.width()-8;o=e>=1?.5+.5*(e-1)/(t.options.maxPlaybackRate-1):.5*(e-t.options.minPlaybackRate)/(1-t.options.minPlaybackRate),t.$rateDot.css("left",i*o+"px"),t.$rateProgressBar.css("width",100*o+"%"),t.$curRateValue.text(Number(e).toFixed(1))},rateUp:function(){var e=this,o=e.$curRateValue.text();o*=1.5;var o=o>e.options.maxPlaybackRate?e.options.maxPlaybackRate:o;e.setRate(o)},rateDown:function(){var e=this,o=e.$curRateValue.text();o/=1.5;var o=e.options.minPlaybackRate>o?e.options.minPlaybackRate:o;e.setRate(o)},_initList:function(){var o=this;o.listCellHasSrcLastIndex=0,o.listCellSrcCompleted=!1,o.$listContent=e("#js-iplayer-list-content"),o.$listInner=e("#js-iplayer-list-inner"),o.$listContainer=e("#js-iplayer-list-container"),o.$listPrevBtn=e("#js-iplayer-list-prev-btn"),o.$listNextBtn=e("#js-iplayer-list-next-btn"),o.listPerNum=Math.floor(o.$listContent.width()/50),o.listCurrentShowingFirstIndex=0,o.listCurrentShowingLastIndex=0,o.$listInner.width(50*Math.min(o.itemsCount,o.listPerNum)),o.$listContainer.width(50*o.itemsCount),o._initListContent(),o._addListEvent(),o.$list.hide()},_initListContent:function(){for(var o=this,t=0,i=0,r=o.originTimelineData.length,n=[];r>t;t++)n.push(o.options.listCellTpl);if(o.$listContainer.html(n.join("")),o.$listCells=o.$listContainer.find(".iplayer-list-cell"),o.itemsCount<=o.listPerNum)for(o.$listPrevBtn.hide(),o.$listNextBtn.hide(),o.listCurrentShowingFirstIndex=0,o.listCurrentShowingLastIndex=o.itemsCount-1,o.listCellHasSrcLastIndex=o.listCurrentShowingLastIndex;r>i;i++)e(o.$listCells[i]).find("img").attr("src",o.originTimelineData[i].thumbnailSrc);else for(o.$listPrevBtn.hide(),o.$listNextBtn.show(),o.listCurrentShowingFirstIndex=0,o.listCurrentShowingLastIndex=o.listPerNum-1,o.listCellHasSrcLastIndex=o.listCurrentShowingLastIndex;o.listPerNum>i;i++)e(o.$listCells[i]).find("img").attr("src",o.originTimelineData[i].thumbnailSrc)},_addListEvent:function(){var e=this;e.$listPrevBtn.on("click",function(o){e._onClickListPrevBtn(o)}),e.$listNextBtn.on("click",function(o){e._onClickListNextBtn(o)}),e.$list.on("click",".iplayer-list-cell",function(o){e._onClickListCell(o)})},_removeListEvent:function(){var e=this;e.$listPrevBtn.off("click"),e.$listNextBtn.off("click"),e.$list.off("click",".iplayer-list-cell")},_onClickListPrevBtn:function(){var e,o=this,t=Math.abs(parseInt(o.$listContainer.css("left")));o.$listNextBtn.show(),o.listCurrentShowingFirstIndex<=o.listPerNum?(o.$listPrevBtn.hide(),e=0,o.$listContainer.css({left:"-"+e+"px"}),o.listCurrentShowingFirstIndex=0,o.listCurrentShowingLastIndex=o.listPerNum-1):(e=t-50*o.listPerNum,o.$listContainer.css({left:"-"+e+"px"}),o.listCurrentShowingLastIndex=o.listCurrentShowingFirstIndex-1,o.listCurrentShowingFirstIndex-=o.listPerNum)},_onClickListNextBtn:function(){var o,t,i,r=this,n=r.itemsCount-1-r.listCurrentShowingLastIndex,a=Math.abs(parseInt(r.$listContainer.css("left")));if(r.$listPrevBtn.show(),r.listPerNum>=n){if(r.$listNextBtn.hide(),o=a+50*n,r.$listContainer.css({left:"-"+o+"px"}),r.listCurrentShowingFirstIndex=r.itemsCount-r.listPerNum,r.listCurrentShowingLastIndex=r.itemsCount-1,r.listCellHasSrcLastIndex<r.itemsCount-1){for(t=r.listCellHasSrcLastIndex+1,i=r.itemsCount;i>t;t++)e(r.$listCells[t]).find("img").attr("src",r.originTimelineData[t].thumbnailSrc);r.listCellHasSrcLastIndex=r.listCurrentShowingLastIndex}}else if(o=a+50*r.listPerNum,r.$listContainer.css({left:"-"+o+"px"}),r.listCurrentShowingFirstIndex=r.listCurrentShowingLastIndex+1,r.listCurrentShowingLastIndex+=r.listPerNum,r.listCellHasSrcLastIndex<r.listCurrentShowingLastIndex){for(t=r.listCellHasSrcLastIndex+1,i=r.listCurrentShowingLastIndex+1;i>t;t++)e(r.$listCells[t]).find("img").attr("src",r.originTimelineData[t].thumbnailSrc);r.listCellHasSrcLastIndex=r.listCurrentShowingLastIndex}},_onClickListCell:function(o){var t=this,i=e(o.currentTarget).position().left/50;i!=t.currentIndex&&t.next(i)},_initActions:function(){var o=this;o.onChangeDisplayTransitions=!1,o.$fullscreen=e("#js-iplayer-fullscreen"),o.$showList=e("#js-iplayer-show-list"),o.$displayTransitions=e("#js-iplayer-display-transitions"),o.$shareCode=e("#js-iplayer-share-code"),o.$shareCodeSection=e("#iplayer-share-code-section"),o.$shareCodeInput=e("#js-iplayer-share-code-input"),o.shareCodeSectionShowing=!1,o._addActionsEvent()},_addActionsEvent:function(){var e=this;e.$fullscreen.on("click",function(o){e._onClickFullscreen(o)}),document.addEventListener(e.fullscreen.fullScreenEventName,function(o){e._onFullscreenChange(o)}),e.$showList.on("click",function(o){e._onClickShowList(o)}),e.$displayTransitions.on("click",function(o){e._onClickDisplayTransitions(o)}),e.$shareCode.on("click",function(o){e._onClickShareCode(o)})},_removeActionsEvent:function(){var e=this;e.$fullscreen.off("click"),e.$showList.off("click"),e.$displayTransitions.off("click"),e.$shareCode.off("click")},_onClickFullscreen:function(){var e=this;return!e.state.fullscreen&&e.fullscreen.supportsFullScreen?(e.enterFullscreen(),!1):e.state.fullscreen?(e.exitFullscreen(),!1):!1},_onFullscreenChange:function(){var e=this;e.fullscreen.isFullScreen(document.getElementById("iplayer"))?(e.state.fullscreen=!0,e.$fullscreen.attr("title","退出全屏播放"),e.$fullscreen.removeClass("icon-iplayer-fullscreen").addClass("icon-iplayer-exit-fullscreen")):(e.state.fullscreen=!1,e.$fullscreen.attr("title","全屏播放"),e.$fullscreen.removeClass("icon-iplayer-exit-fullscreen").addClass("icon-iplayer-fullscreen"))},_onClickShowList:function(){var e=this;return e.state.listShowing?e.hideList():e.showList(),!1},_onClickDisplayTransitions:function(){var e=this;if(!e.onChangeDisplayTransitions)return e.onChangeDisplayTransitions=!0,e.state.displayTransitions?(e.cancelTransitions(),e.$displayTransitions.removeClass("active")):(e.displayTransitions(),e.$displayTransitions.addClass("active")),!1},_onClickShareCode:function(){var e=this,o='<iframe width="854" height="480" src="'+e.options.shareCode+'" frameborder="0" allowfullscreen></iframe>';e.shareCodeSectionShowing?(e.shareCodeSectionShowing=!1,e.$shareCodeSection.hide(),e.$shareCode.removeClass("active"),e.diaporama.paused&&e._onClickPlayBtn()):(e.shareCodeSectionShowing=!0,e.$shareCodeInput.val(o),e.$shareCodeSection.show(),e.$shareCodeInput.focus(),e.$shareCodeInput.select(),e.$shareCode.addClass("active"),e.diaporama.paused||e._onClickPlayBtn())},enterFullscreen:function(){var e=this;!e.state.fullscreen&&e.fullscreen.supportsFullScreen&&(e.state.fullscreen=!0,e.$fullscreen.attr("title","退出全屏播放"),e.fullscreen.requestFullScreen(document.getElementById("iplayer")),e.$fullscreen.removeClass("icon-iplayer-fullscreen").addClass("icon-iplayer-exit-fullscreen"))},exitFullscreen:function(){var e=this;e.state.fullscreen&&(e.state.fullscreen=!1,e.$fullscreen.attr("title","全屏播放"),e.fullscreen.cancelFullScreen(document.getElementById("iplayer")),e.$fullscreen.removeClass("icon-iplayer-exit-fullscreen").addClass("icon-iplayer-fullscreen"))},showList:function(){var o,t,i=this;if(!i.state.listShowing&&(i.state.listShowing=!0,i.$list.fadeIn(),i.$showList.addClass("active"),i.$showList.attr("title","隐藏列表"),i.listCellHasSrcLastIndex<i.listCurrentShowingLastIndex)){for(o=i.listCellHasSrcLastIndex+1,t=i.listCurrentShowingLastIndex+1;t>o;o++)e(i.$listCells[o]).find("img").attr("src",i.originTimelineData[o].thumbnailSrc);i.listCellHasSrcLastIndex=i.listCurrentShowingLastIndex}},hideList:function(){var e=this;e.state.listShowing&&(e.state.listShowing=!1,e.$list.fadeOut(),e.$showList.removeClass("active"),e.$showList.attr("title","显示列表"))},displayTransitions:function(){var o=this,t=e(window),i=t.width(),r=t.height();return o.diaporama.pause(),o.diaporama.loop=!1,o.transitionTimelineData?o.diaporamaData.timeline=o.transitionTimelineData:(o.diaporamaData.timeline=o.getDiaporamaTimelineData(o.originTimelineData,i,r,!0),o.transitionTimelineData=o.diaporamaData.timeline),o.diaporama.data=o.diaporamaData,o.diaporama.loop=!0,o.next(0),o.diaporama.play(),o.onChangeDisplayTransitions=!1,o.state.displayTransitions=!0,o.$displayTransitions.attr("title","取消特效"),!1},cancelTransitions:function(){var o=this,t=e(window),i=t.width(),r=t.height();return o.diaporama.pause(),o.diaporama.loop=!1,o.noTransitionTimelineData?o.diaporamaData.timeline=o.noTransitionTimelineData:(o.diaporamaData.timeline=o.getDiaporamaTimelineData(o.originTimelineData,i,r,!1),o.noTransitionTimelineData=o.diaporamaData.timeline),o.diaporama.data=o.diaporamaData,o.diaporama.loop=!0,o.next(0),o.diaporama.play(),o.onChangeDisplayTransitions=!1,o.state.displayTransitions=!1,o.$displayTransitions.attr("title","启用特效"),!1},next:function(e){var o=this;o.playByNoDiaporama=!0,e!==undefined&&e!=o.currentIndex?(1===e-o.currentIndex?o.diaporama.next():-1===e-o.currentIndex?o.diaporama.prev():o.diaporama.jump(e),o._updatePlayPosition(e)):e===undefined&&(o.diaporama.next(),o._updatePlayPosition(o.currentIndex+1))},nextRandom:function(){var e=this,o=e._getRandomIndex();e.playByNoDiaporama=!0,1===o-e.currentIndex?e.diaporama.next():-1===o-e.currentIndex?e.diaporama.prev():e.diaporama.jump(o),e._updatePlayPosition(o)},_getRandomIndex:function(){var e=this,o=Math.floor(Math.random()*e.itemsCount);return o===e.currentIndex&&(o=e._getRandomIndex()),o},prev:function(){var e=this;e.playByNoDiaporama=!0,e.diaporama.prev(),e._updatePlayPosition(e.currentIndex-1)},_updatePlayPosition:function(e,o){var t,i=this;(e!==i.currentIndex||o)&&(e>=i.itemsCount&&(e=0),0>e&&(e=i.itemsCount-1),t=e/(i.itemsCount-1),i.currentIndex=e,i.setPosition(t),i._updateAuthorInfo(),i._updateListCurrentIndex())},_updateAuthorInfo:function(){var o=this,t=o.originTimelineData[o.currentIndex];o.$likeBtn||(o.$likeBtn=e("#js-iplayer-like-btn")),o.$infoTitle.attr("href",t.titleSrc).attr("title",t.title).text(t.title),o.$infoAuthor.attr("href",t.authorSrc).attr("title",t.author).text(t.author),o.$likeBtn.attr({"data-image-id":t.id}),t.liked?o.$likeBtn.addClass("active"):o.$likeBtn.removeClass("active")},_updateListCurrentIndex:function(){var o=this;o.$listCells.removeClass("active"),e(o.$listCells[o.currentIndex]).addClass("active"),!o.state.listShowing&&o.itemsCount>o.listPerNum&&o._centerListCurrentIndex()},_centerListCurrentIndex:function(){var e,o=this;o.currentIndex<=Math.floor((o.listPerNum-1)/2)?(o.$listPrevBtn.hide(),o.$listNextBtn.show(),e=0,o.$listContainer.css({left:"-"+e+"px"}),o.listCurrentShowingFirstIndex=0,o.listCurrentShowingLastIndex=o.listPerNum-1):o.currentIndex>=o.itemsCount-Math.floor(o.listPerNum/2)+1?(o.$listNextBtn.hide(),o.$listPrevBtn.show(),e=50*(o.itemsCount-o.listPerNum),o.$listContainer.css({left:"-"+e+"px"}),o.listCurrentShowingFirstIndex=o.itemsCount-o.listPerNum,o.listCurrentShowingLastIndex=o.itemsCount-1):(o.$listNextBtn.show(),o.$listPrevBtn.show(),e=50*(o.currentIndex-Math.floor((o.listPerNum-1)/2)),o.$listContainer.css({left:"-"+e+"px"}),o.listCurrentShowingFirstIndex=o.currentIndex-Math.floor((o.listPerNum-1)/2),o.listCurrentShowingLastIndex=o.currentIndex+Math.floor(o.listPerNum/2))},_initButtons:function(){var o=this;o.$closeBtn=e("#js-iplayer-close-btn"),o.$prevBtn=e("#js-iplayer-prev-btn"),o.$nextBtn=e("#js-iplayer-next-btn"),o.$playBtn=e("#js-iplayer-play-btn"),o.$likeBtn=e("#js-iplayer-like-btn"),o._addButtonsEvent()},_addButtonsEvent:function(){var e=this;e.$closeBtn.on("click",function(){e.hide()}),e.$prevBtn.on("click",function(o){e._onClickPrevBtn(o)}),e.$nextBtn.on("click",function(o){e._onClickNextBtn(o)}),e.$playBtn.on("click",function(o){e._onClickPlayBtn(o)}),e.$likeBtn.on("click",function(o){e._onClickLikeBtn(o)})},_removeButtonsEvent:function(){var e=this;e.$closeBtn.off("click"),e.$prevBtn.off("click"),e.$nextBtn.off("click"),e.$playBtn.off("click"),e.$likeBtn.off("click")},hide:function(){var o=this;return o.diaporama.pause(),o.diaporama.loop=!1,o._removeKeyboardEvent(),e(document.body).css({overflow:"auto"}),o._hideTimer&&clearTimeout(o._hideTimer),o.state.fullscreen&&o.exitFullscreen(),o.$iplayer.hide(),!1},_addAllEvent:function(){var o=this;o._addDiaporamaEvent(),o._addInfoEvent(),o._addRateEvent(),o._addListEvent(),o._addActionsEvent(),o._addButtonsEvent(),o._addKeyboardEvent(),o.$clickSection.on("click",function(e){o._onClickPlayBtn(e)}),e(document).on("mousemove.iplayer",function(e){o._onMousemove(e)}),o._onMousemove()},_removeAllEvent:function(){var o=this;o._removeDiaporamaEvent(),o._removeInfoEvent(),o._removeRateEvent(),o._removeListEvent(),o._removeActionsEvent(),o._removeButtonsEvent(),o.$handle.off("click"),o._removeKeyboardEvent(),e(document).off("mousemove.iplayer")},_onClickPrevBtn:function(){var e=this;e.prev()},_onClickNextBtn:function(){var e=this;e.next()},_onClickPlayBtn:function(){var e=this;e.diaporama.paused&&e.shareCodeSectionShowing&&(e.shareCodeSectionShowing=!1,e.$shareCodeSection.hide(),e.$shareCode.removeClass("active")),e.diaporama.paused=!e.diaporama.paused,e.$playBtn.hasClass("icon-iplayer-play")?(e.$playBtn.removeClass("icon-iplayer-play"),e.$playBtn.addClass("icon-iplayer-pause")):(e.$playBtn.removeClass("icon-iplayer-pause"),e.$playBtn.addClass("icon-iplayer-play"))},_onClickLikeBtn:function(o){var t=this,i=e(o.target),r=parseInt(i.attr("data-image-id")),n=t.originTimelineData[t.currentIndex];i.hasClass("active")?e.getJSON(c,{id:r},function(e){e.success&&(n.liked=!1,parseInt(t.$likeBtn.attr("data-image-id"))===r&&t.$likeBtn.removeClass("active"))}):e.getJSON(l,{id:r},function(e){e.success&&(n.liked=!0,parseInt(t.$likeBtn.attr("data-image-id"))===r&&t.$likeBtn.addClass("active"))})},_onMousemove:function(o){var t=this;t._hideTimer&&(clearTimeout(t._hideTimer),t.$handle.css(a),t.$bottom.show(),t.$logo.length&&t.$logo.fadeIn()),e("#iplayer").height()-o.pageY>130&&!t.diaporama.paused&&(t._hideTimer=setTimeout(function(){t._hideControlPanel(),t.$logo.length&&t.$logo.fadeOut()},2e3))},_hideControlPanel:function(){var e=this;e.$handle.css(n),e.$bottom.fadeOut()},_addKeyboardEvent:function(){var o=this;e(document.body).on("keyup.iplayer",function(e){o._onKeyup(e)})},_removeKeyboardEvent:function(){e(document.body).off("keyup.iplayer")},_onKeyup:function(e){var o=this;switch(e.which){case 38:o.rateUp();break;case 40:o.rateDown();break;case 37:o.prev();break;case 39:o.next();break;case 32:o._onClickPlayBtn();break;case 13:o.state.fullscreen?o.exitFullscreen():o.enterFullscreen()}},_initImageActions:function(){},prepend:function(e){var o=this,t=e.length-1;for(o.diaporama.pause(),o.diaporama.loop=!1;t>-1;t--)o.originTimelineData.unshift(e[t]);o._reinit()},append:function(e){var o,t=this,i=e.length;for(t.diaporama.pause(),t.diaporama.loop=!1,o=0;i>o;o++)t.originTimelineData.push(e[o]);t._reinit()},replace:function(o){var t=this;t.originTimelineData=e.extend([],o),t._reinit()},_reinit:function(){var e=this;e.$iplayer.show(),e._reinitProperties(),e._reinitContainer(),e._reinitDiaporama(),e._reinitInfoComponent(),e._reinitList(),e._addKeyboardEvent(),e._updatePlayPosition(0,!0)},_reinitProperties:function(){var e=this;e.state.fullscreen=!1,e.state.listShowing=!1,e.itemsCount=e.originTimelineData.length,e.currentIndex=0,e._hideTimer=null,e.transitionTimelineData=null,e.noTransitionTimelineData=null,e.state.displayTransitions||(e.playByNoDiaporama=!0)},_reinitContainer:function(){e(document.body).css({overflow:"hidden"})},_reinitDiaporama:function(){var o=this,t=e(window),i=t.width(),r=t.height();o.diaporamaData.timeline=o.getDiaporamaTimelineData(o.originTimelineData,i,r,o.state.displayTransitions),o.state.displayTransitions?o.transitionTimelineData=o.diaporamaData.timeline:o.noTransitionTimelineData=o.diaporamaData.timeline,o.diaporama.loop=!1,o.diaporama.data=o.diaporamaData,o.diaporama.loop=!0,o.diaporama.jump(0),o.diaporama.play(),o.$playBtn.removeClass("icon-iplayer-play"),o.$playBtn.addClass("icon-iplayer-pause"),o.$showList.removeClass("active")},_reinitInfoComponent:function(){var e=this;e.resetPosition()},_reinitList:function(){var e=this;e.listCellHasSrcLastIndex=0,e.listCellSrcCompleted=!1,e.listCurrentShowingFirstIndex=0,e.listCurrentShowingLastIndex=0,e.$listInner.width(50*Math.min(e.itemsCount,e.listPerNum)),e.$listContainer.width(50*e.itemsCount),e._initListContent(),e.$list.hide()}};var f={};f.play=function(o,i,r){r===undefined&&(r=!0),f.iPlayer===undefined?f.iPlayer=new t(o,i):(e.extend(!0,f.iPlayer.options,i),r?f.iPlayer.replace(o):f.iPlayer.prepend(o))},f.close=function(){f.iPlayer!==undefined&&f.iPlayer.hide()},window.iplayer=f})(jQuery,Diaporama);